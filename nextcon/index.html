<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">

  
  <script src="https://cdn.tailwindcss.com"></script>
  <script> 
    tailwind.config = {
      theme: {extend: {colors: { crimson: '#B11016', crimsonlight: '#f4d3d5' }}}
    }
  </script>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-analytics.js";
  
    const firebaseConfig = {
      apiKey: "AIzaSyA5vKyvf5280pdHW429o71hD8p4BgoYNM0",
      authDomain: "ku-crowdy.firebaseapp.com",
      projectId: "ku-crowdy",
      storageBucket: "ku-crowdy.appspot.com",
      messagingSenderId: "300944597074",
      appId: "1:300944597074:web:2b8675a14afca78873af8b",
      measurementId: "G-68YKXBL9BY"
    };
  
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
  
    console.log("✅ Firebase 연결 완료!");
  </script>
  
  <script>
    function initMap() {
      const mapCenter = { lat: 37.5894, lng: 127.0335 }; // 고려대 본관 근처
  
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 17,
        center: mapCenter,
      });
      const greyMarkerSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="#969696" d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>`;
      const places = [
      { name: "자하연", lat: 37.5898, lng: 127.0340 },
      { name: "정운오IT교양관 1층", lat: 37.5885, lng: 127.0323 }
      ];

      places.forEach( place => {
        const marker = new google.maps.Marker({
          position: { lat: place.lat, lng: place.lng },
          map,
          title: place.name,
          icon: {
            url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(greyMarkerSvg),
            scaledSize: new google.maps.Size(32, 32)
          }
        });
        marker.addListener("click", () => {  
          openvote(place.name); 
        });
        
      });
      
      
    }
  </script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAJS-A7wr1m8xgJHS57jOqO4cmyYA42RK8&callback=initMap"
    async
    defer
  ></script>
  
  <script>
    function togglePopup() {
      const popup = document.getElementById("Mypopup");
      popup.classList.toggle("hidden");
    }

    // [선택] 열람권 있으면 Crowdy Map 버튼 보이기
    const hasAccess = true; // 나중엔 Firebase 값으로 대체
    if (hasAccess) {
      document.getElementById("crowdyMapBtn").classList.remove("hidden");
    }
  </script>
  
  <title>KUcrowdy</title> 
</head>


<body class="relative bg-black text-white min-h-screen overflow-hidden">
  <div class="absolute inset-0 bg-[url('./image_nextcon/korea_univ.jpg')] bg-cover bg-center opacity-30 brightness-60 z-0"></div>

  <div class="relative z-10 flex flex-col min-h-screen">
    <header class="flex justify-between items-center px-4 py-3 bg-white shadow relative">
      <h1 class="text-xl font-extrabold text-crimson">KUcrowdy</h1>

      <div class="flex items-center gap-3">
        <button id="crowdymap" class="bg-[#d13d47] font-semibold text-white px-3 py-1 rounded" onclick="location.href='crowdymap.html'">
          Crowdy Map
        </button>
        <button onclick="togglePopup()" class="bg-red-0 font-semibold text-crimson px-3 py-1 rounded hover:bg-crimson hover:text-white">
          MY
        </button>
      </div>
      <div id="Mypopup" class="absolute right-4 top-16 bg-white shadow rounded p-4 hidden w-60 z-20">
        <p class="font-semibold text-black">보유 포인트: <span id="pointDisplay"></span>1P</p>
        <p class="font-semibold text-black mb-2">보유 열람권: <span id="ticketDisplay"></span>1장</p>
        <button class="bg-crimson font-semibold text-white px-4 py-2 rounded w-full hover:bg-crimsonlight mb-2" onclick="purchaseTicket()">
          열람권 구매하기
        </button>
        <button class="bg-yellow-300 font-semibold text-white px-4 py-2 rounded w-full hover:bg-yellow-200 mb-2" onclick="useTicket()">
          열람권 사용하기
        </button>
      </div>
  

    </header>
    
    <div class="flex-grow flex items-center justify-center p-6">
      <div id="map" class="w-[90vw] max-w-4xl h-[60vh] bg-gray-200 rounded shadow-lg border-2 border-white">
        <!-- 지도 로딩 전 안내 텍스트 -->
        <p class="text-center text-gray-600">지도 로딩 중...</p>
      </div>
    </div>

    <div id="votePopup" class="hidden fixed bg-white shadow-lg rounded px-6 py-4 max-w-fit top-1/2 left-1/2 -translate-x-1/2 z-50">
      <p id="popupTitle" class="text-center text-black font-bold text-base mb-4 whitespace-nowrap">혼잡도를 선택해주세요</p>
      <div class="flex justify-between gap-4 mb-4">
         <button onclick="vote('여유')" class="w-12 h-12 rounded-full bg-green-400 hover:bg-green-500"></button>
         <button onclick="vote('보통')" class="w-12 h-12 rounded-full bg-yellow-400 hover:bg-yellow-500"></button>
         <button onclick="vote('혼잡')" class="w-12 h-12 rounded-full bg-red-400 hover:bg-red-500"></button>
      </div>
      <button class="w-full bg-gray-300 text-black font-semibold py-2 rounded hover:bg-gray-400" onclick="closevote()">닫기</button>
    </div>


  </div>
 
  <script src="./js_nextcon/mypage.js"></script>
  <script src="./js_nextcon/votepopup.js"></script>
</body>
</html>
